- type: htnCompound
  id: STBearCompound
  branches:
  - tasks:
    - !type:HTNCompoundTask
      task: STBearMeleeCombatCompound
  - tasks:
    - !type:HTNCompoundTask
      task: STBearRoarRestoreCompound
    - !type:HTNCompoundTask
      task: IdleCompound

- type: htnCompound
  id: STBearMeleeCombatCompound
  branches:
  # Move to melee range and hit them
  - tasks:
    - !type:HTNPrimitiveTask
      operator: !type:UtilityOperator
        proto: NearbyMeleeTargets
    - !type:HTNCompoundTask
      task: STBearRoarCompound
    - !type:HTNCompoundTask
      task: STBearMeleeAttackTargetCompound

- type: htnCompound
  id: STBearRoarRestoreCompound
  preconditions:
  - !type:KeyBoolEqualsPrecondition
    key: Roared
    value: true
  branches:
  - tasks:
    - !type:HTNPrimitiveTask
      operator: !type:SetBoolOperator
        targetKey: Roared
        value: false

- type: htnCompound
  id: STBearRoarCompound
  preconditions:
  - !type:KeyExistsPrecondition
    key: Target
  - !type:KeyBoolEqualsPrecondition
    key: Roared
    value: false
  branches:
  - tasks:
    - !type:HTNPrimitiveTask
      operator: !type:PlaySoundOperator
        sound:
          path: /Audio/Animals/bear.ogg
          params:
            variation: 0.125
    - !type:HTNPrimitiveTask
      operator: !type:JukeOperator
        jukeType: AdjacentTile
    - !type:HTNPrimitiveTask
      operator: !type:JukeOperator
        jukeType: AdjacentTile
# id put a waitoperator here instead of juke if i could figure out how to use it but my brain stupid
    - !type:HTNPrimitiveTask
      operator: !type:SetBoolOperator
        targetKey: Roared
        value: true

- type: htnCompound
  id: STBearMeleeAttackTargetCompound
  preconditions:
  - !type:KeyExistsPrecondition
    key: Target
  branches:
  - tasks:
    - !type:HTNPrimitiveTask
      operator: !type:MoveToOperator
        shutdownState: PlanFinished
        pathfindInPlanning: true
        removeKeyOnFinish: false
        targetKey: TargetCoordinates
        pathfindKey: TargetPathfind
        rangeKey: MeleeRange
    - !type:HTNPrimitiveTask
      operator: !type:MoveToOperator
        shutdownState: PlanFinished
        pathfindInPlanning: true
        removeKeyOnFinish: false
        targetKey: TargetCoordinates
        pathfindKey: TargetPathfind
        rangeKey: MeleeRange
    - !type:HTNPrimitiveTask
      operator: !type:JukeOperator
        jukeType: AdjacentTile
    - !type:HTNPrimitiveTask
      operator: !type:JukeOperator
        jukeType: AdjacentTile
    - !type:HTNPrimitiveTask
      operator: !type:MeleeOperator
        targetKey: Target
      preconditions:
      - !type:KeyExistsPrecondition
        key: Target
      - !type:TargetInRangePrecondition
        targetKey: Target
        rangeKey: MeleeRange
      services:
      - !type:UtilityService
        id: MeleeService
        proto: NearbyMeleeTargets
        key: Target
